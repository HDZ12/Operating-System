# 1.1操作系统的功能

计算机系统可以粗分为：硬件，操作系统，应用程序，用户。

**操作系统控制硬件，并协调各个应用程序的硬件使用**

操作系统的定义：

- 计算机系统中的一个系统软件，一些程序模块的集合。
- 管理和控制计算机系统中的软件和硬件资源
- 合理地组织计算机工作流程
- 在计算机与其用户之间起到接口的作用

## 1.2计算机系统的运行

- 一个或多个CPU和若干设备控制器，通过共用总线相连
  
  **总线提供了对共享内存的访问**
- CPU和设备并发执行，竞争访问内存
  
  **每种设备控制器负责一种特定的设备类型**
  
  **每个设备控制器有一个local缓冲寄存器**
  
  **CPU在主存和缓存寄存器之间移动数据**
- 设备通过发出中断通知CPU已完成操作
- 开机时运行引导程序
  
  **位于ROM或者EEPROM（*电可擦可编程只读内存*）**
  
  **初始化系统各个组件，从CPU寄存器，设备控制器到内存内容**
  
  **定位外存硬盘上的操作系统内核并且加载到内存**
- 内核加载到内存开始运行
  
  **设置和初始化各种数据结构与表格，建立各种控制系统内核运行的系统进程和系统后台进程**
  
  **等待事件发生**
- 事件发生通过硬件和软件中断来通知
  
  **硬件中断的触发：硬件随时通过系统总线发送信号到CPU**
  
  **软件中断的触发：程序中发出系统调用**
- 将控制转移给中断服务程序
  
  **通过中断向量，它包含了所有中断服务程序的入口地址**
- 保存中断指令的地址
  
  **在系统栈上**
  
  **处理完终端，保存的返回地址会加载到程序计数器，被中断的程序继续执行**
- 操作系统是中断驱动的

## 存储结构

### 存储定义与符号

- bit（位，比特）
- Byte（字节）
- word（字）

***

- **内存高速缓存**
  
  ==计算机系统的一部分，由硬件实现，对操作系统不可见。==
- **主存(main memory)(Random Acess Memory)**
  
  ==CPU能直接访问==
  
  ==易失的==
- **二级存储：主存的扩充，大容量不易失**
  
  ==硬盘，磁盘==
  
  ==固态硬盘：低功耗，无噪音，体积小，发热量小。读写速度远高于传统硬盘==

### 存储设备的层次

1. **registers**
2. **cache**
3. **main memory**
4. **soid-state disk**
5. **hard disk**
6. **optical disk**
7. **magnetic disk**

==***层次结构成功的关键：低层访问频率递减***==

存储器的三个特性：

- **容量，存取速度和价格**
- **存取速度越快，每个‘位’价格越高**
- **容量越大，每个‘位’价格越低**
- **容量越大，存取速度越慢**

# 1.3计算机系统的体系结构

## 单处理器系统

## 多处理器系统

- 优点：**增加吞吐量，规模经济，增加可靠性**
- 非对称处理器：
  
  ***主处理器*：一个，只运行os，管理整个系统的资源，未从处理器分配任务**
  
  ***从处理器*：可有多个，执行应用程序或I/O处理**
  
  ***==不同性质任务的负载不均，可靠性不高==***

- 对称处理器：
  
  **每个处理器都参与完成操作系统所有任务**
  
  **任务负载较为平均，性能调节容易**
  
  **几乎所有现代操作系统支持**

## 集群系统

- 由两个或多个独立的系统（或结点）组成
  
  **每个节点可谓单处理器系统或多核系统**
  
  **集群计算机共享存储**

- 高可用性
  
  **集群中的一个或多个系统出错，仍可继续提供服务**

- 对称的：
  
  **两个或多个主机都运行程序，并互相监视**
  
  **充分利用现有硬件，当多个应用程序可供执行时，更有效**

- 非对称的
  
  **一台处于热备份模式，另一台运行应用程序**

- 应用
  
  ***高性能计算机(HPC)*:并行计算(parallelization),将一个程序分成多个部分，并行运行在各个核上**
  
  ***分布锁管理器(Distributed Lock Manger，DLM)*:多个主机访问共享存储的同一数据**

## 操作系统的执行

==现代操作系统是靠中断驱动的==

- **硬件中断:设备发出的**
- **软中断：**
  
  软件出错（如除数为0、无效的存储访问）、进程试图修改别的进程或OS等
  
  进程发出系统调用，需要操作系统服务

OS和多个进程共享计算机系统的软硬件资源，
为确保OS的正确运行，区分OS代码和用户代码的运行。

**==多数系统将处理器划分为管态和目态==**

## 双重模式与多重模式的执行

- **管态（特权态，系统态，内核态）**
  
  操作系统程序运行时的状态，较高的特权级别
  
  可以执行所有的指令（包括特权指令）、使用所有
的资源，并具有改变处理器状态的能力

- **目态（普通态，普态，用户态）**
  
  用户程序运行时的状态，较低的特权级别；
  
  禁止使用特权指令，不能直接使用系统资源与改变
CPU状态，只能访问用户程序所在的存储空间。

## 特权指令

- 访问某些硬件资源的指令
- 对I/O设备直接访问的指令。
- 对内存管理状态进行操作的指令
- 某些特殊的状态位的设置指令
- 停机指令

**==只有操作系统有权使用==**

## x86系列处理器的执行模式

- R0:双状态系统的管态，运行操作系统核心代码
- R3:目态
- R1：运行关键设备驱动程序和/O处理例程
- R2:运行其它受保护共享代码，如语言系统运行环境

## 程序状态字PSW(Program Status Word)

- 状态码：管态还是目态，决定是否可以使用特权指令或拥
有其它的特殊权力；
- 条件码：指令执行后的结果特征；
- 中断屏蔽码：是否允许中断

**==CPU工作状态之间如何转换？==**

- 管态→目态
设置PSW
- 目态→管态
用户程序无法直接修改程序状态字；通过系统调用

## 系统调用

操作系统内核函数
用户程序通过访管指令，请求操作系统提供某种服务。

- 当CPU执行访管指令时，引起访管中断；
- 处理器保存中断点的程序执行上下文环境(PSW、
PC和其它寄存器)，CPU切换到管态（硬件自动完成）。
- 中断处理程序开始工作，调用相应的系统服务；
- 结束后，恢复被中断程序的上下文环境，
CPU恢复为目态，回到中断点继续执行。

# 1.5操作系统的功能

![1697027311329.png](https://github.com/HDZ12/Operating-System/blob/main/%E9%99%84%E4%BB%B6/1699691579354.png)
